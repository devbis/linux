# SPDX-License-Identifier: (GPL-2.0-only OR BSD-2-Clause)
%YAML 1.2
---

$id: "http://devicetree.org/schemas/display/msm/qcom,hdmi.yaml#"
$schema: "http://devicetree.org/meta-schemas/core.yaml#"

title: Qualcomm Adreno/Snapdragon HDMI output

maintainers:
  - Rob Clark <robdclark@gmail.com>

properties:
  compatible:
    contains:
      enum:
        - qcom,hdmi-tx-8996
        - qcom,hdmi-tx-8994
        - qcom,hdmi-tx-8084
        - qcom,hdmi-tx-8974
        - qcom,hdmi-tx-8660
        - qcom,hdmi-tx-8960

  clocks:
    minItems: 1
    maxItems: 3

  clock-names:
    minItems: 1
    maxItems: 3

  reg:
    minItems: 1
    maxItems: 3
    description: Physical base address and length of the controller's registers

  reg-names:
    anyOf:
      - items:
          - const: core_physical
      - items:
          - const: core_physical
          - const: qfprom_physical
          - const: hdcp_physical

  interrupts:
    description: The interrupt signal from the hdmi block.

  power-domains:
    description: should be <&mmcc MDSS_GDSC>

  core-vdda-supply:
    description: phandle to supply regulator

  hdmi-mux-supply:
    description: phandle to mux regulator

  phys:
    description: the phandle for the HDMI PHY device

  phy-names:
    description: the name of the corresponding PHY device

  hpd-gpios:
    description: hpd pin

  qcom,hdmi-tx-mux-en-gpios:
    description: hdmi mux enable pin

  qcom,hdmi-tx-mux-sel-gpios:
    description: hdmi mux select pin

  qcom,hdmi-tx-mux-lpm-gpios:
    description: hdmi mux lpm pin

  pinctrl-0: true
  pinctrl-1: true

  pinctrl-names:
    anyOf:
      - items:
          - const: default
      - items:
          - const: default
          - const: sleep

  ports:
    type: object
    $ref: "/schemas/graph.yaml#/properties/ports"
    properties:
      port@0:
        $ref: "/schemas/graph.yaml#/$defs/port-base"
        unevaluatedProperties: false
        description: |
          Input endpoints of the controller.
        properties:
          endpoint:
            $ref: /schemas/media/video-interfaces.yaml#
            unevaluatedProperties: false
            properties:
              data-lanes:
                maxItems: 4
                minItems: 4
                items:
                  enum: [0, 1, 2, 3]

      port@1:
        $ref: "/schemas/graph.yaml#/$defs/port-base"
        unevaluatedProperties: false
        description: |
          Output endpoints of the controller.
        properties:
          endpoint:
            $ref: /schemas/media/video-interfaces.yaml#
            unevaluatedProperties: false
            properties:
              data-lanes:
                maxItems: 4
                minItems: 4
                items:
                  enum: [0, 1, 2, 3]

    required:
      - port@0
      - port@1

required:
  - compatible
  - clocks
  - clock-names
  - reg
  - reg-names
  - interrupts
  - phys
  - phy-names

additionalProperties: false
# HDMI PHY:
# Required properties:
# - compatible: Could be the following
#   * "qcom,hdmi-phy-8660"
#   * "qcom,hdmi-phy-8960"
#   * "qcom,hdmi-phy-8974"
#   * "qcom,hdmi-phy-8084"
#   * "qcom,hdmi-phy-8996"
# - #phy-cells: Number of cells in a PHY specifier; Should be 0.
# - reg: Physical base address and length of the registers of the PHY sub blocks.
# - reg-names: The names of register regions. The following regions are required:
#   * "hdmi_phy"
#   * "hdmi_pll"
#   For HDMI PHY on msm8996, these additional register regions are required:
#     * "hdmi_tx_l0"
#     * "hdmi_tx_l1"
#     * "hdmi_tx_l3"
#     * "hdmi_tx_l4"
# - power-domains: Should be <&mmcc MDSS_GDSC>.
# - clocks: device clocks
#   See Documentation/devicetree/bindings/clock/clock-bindings.txt for details.
# - core-vdda-supply: phandle to vdda regulator device node

examples:
  - |
    hdmi: hdmi@4a00000 {
      compatible = "qcom,hdmi-tx-8960";
      reg-names = "core_physical";
      reg = <0x04a00000 0x2f0>;
      interrupts = <GIC_SPI 79 0>;
      power-domains = <&mmcc MDSS_GDSC>;
      clock-names =
          "core",
          "master_iface",
          "slave_iface";
      clocks =
          <&mmcc HDMI_APP_CLK>,
          <&mmcc HDMI_M_AHB_CLK>,
          <&mmcc HDMI_S_AHB_CLK>;
      qcom,hdmi-tx-ddc-clk = <&msmgpio 70 GPIO_ACTIVE_HIGH>;
      qcom,hdmi-tx-ddc-data = <&msmgpio 71 GPIO_ACTIVE_HIGH>;
      qcom,hdmi-tx-hpd = <&msmgpio 72 GPIO_ACTIVE_HIGH>;
      core-vdda-supply = <&pm8921_hdmi_mvs>;
      hdmi-mux-supply = <&ext_3p3v>;
      pinctrl-names = "default", "sleep";
      pinctrl-0 = <&hpd_active  &ddc_active  &cec_active>;
      pinctrl-1 = <&hpd_suspend &ddc_suspend &cec_suspend>;

      phys = <&hdmi_phy>;
      phy-names = "hdmi_phy";
    };

    hdmi_phy: phy@4a00400 {
      compatible = "qcom,hdmi-phy-8960";
      reg-names = "hdmi_phy",
                  "hdmi_pll";
      reg = <0x4a00400 0x60>,
            <0x4a00500 0x100>;
      #phy-cells = <0>;
      power-domains = <&mmcc MDSS_GDSC>;
      clock-names = "slave_iface";
      clocks = <&mmcc HDMI_S_AHB_CLK>;
      core-vdda-supply = <&pm8921_hdmi_mvs>;
    };
